{% extends 'base.html' %}

{% block title %}Chat Room Detail{% endblock %}

{% block content %}
    <h1>Chat Room: {{ chat_room.name }}</h1>
    
    <h2>Messages</h2>
    <div id="message-container" style="border: 1px solid #ccc; padding: 10px; max-height: 400px; overflow-y: auto;">
        {% if messages %}
            <ul id="message-list">
                {% for message in messages %}
                    <li>
                        <strong>
                            {% if message.user %}
                                {{ message.user.username }}
                            {% else %}
                                Anonymous
                            {% endif %}
                        </strong>
                        : {{ message.content }} <em>({{ message.created_at }})</em>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No messages in this chat room.</p>
        {% endif %}
    </div>
    
    <h2>Send a new message</h2>
    <form method="post" action="{% url 'create_message' chat_room.id %}">
        {% csrf_token %}
        <label for="content">Message:</label>
        <textarea id="content" name="content" required></textarea>
        <button type="submit">Send</button>
    </form>

    <h2>Actions</h2>
    <form method="post" action="{% url 'leave_chat_room' chat_room.id %}">
        {% csrf_token %}
        <button type="submit">Leave Chat Room</button>
    </form>
    {% if chat_room.created_by == user %}
        <form method="post" action="{% url 'delete_chat_room' chat_room.id %}">
            {% csrf_token %}
            <button type="submit">Delete Chat Room</button>
        </form>
    {% endif %}
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var messageContainer = document.getElementById("message-container");
        messageContainer.scrollTop = messageContainer.scrollHeight;
    });
</script>
{% endblock %}